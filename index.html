<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Consulta de Aulas ‚Äî UPDS</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
<style>
:root {
  --clr-bg: #0b0f1a; --clr-surface: #111827; --clr-surface2: #1a2236;
  --clr-border: #2a3550; --clr-accent: #38bdf8; --clr-accent2: #818cf8;
  --clr-text: #e2e8f0; --clr-muted: #64748b; --clr-danger: #f87171; --clr-success: #34d399;
  --clr-turno-man: #fbbf24; --clr-turno-med: #fb923c; --clr-turno-tar: #a78bfa; --clr-turno-noc: #38bdf8;
  --font-head: 'Bebas Neue', sans-serif; --font-body: 'DM Sans', sans-serif;
  --radius: 10px; --radius-sm: 6px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: var(--font-body); background: var(--clr-bg); color: var(--clr-text); min-height: 100vh; line-height: 1.5; }
.glow { position: fixed; inset: 0; pointer-events: none; z-index: 0;
  background: radial-gradient(ellipse 80% 50% at 20% 10%, rgba(56,189,248,.12) 0%, transparent 60%),
              radial-gradient(ellipse 60% 40% at 80% 80%, rgba(129,140,248,.08) 0%, transparent 55%); }
.wrapper { position: relative; z-index: 1; max-width: 860px; margin: 0 auto; padding: 0 24px 80px; }

.header { text-align: center; padding: 72px 0 48px; }
.header__badge { display: inline-flex; align-items: center; gap: 8px; background: var(--clr-surface); border: 1px solid var(--clr-border);
  border-radius: 999px; padding: 6px 16px; margin-bottom: 24px; font-size: .78rem; letter-spacing: .06em; text-transform: uppercase; color: var(--clr-accent); font-weight: 500; }
.header__badge .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--clr-success); box-shadow: 0 0 6px var(--clr-success); animation: pulse-dot 2s infinite; }
@keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: .4; } }
.header h1 { font-family: var(--font-head); font-size: clamp(2.4rem, 8vw, 4rem); letter-spacing: .04em; line-height: 1.05; }
.header h1 span { background: linear-gradient(90deg, var(--clr-accent), var(--clr-accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.header p { margin-top: 16px; color: var(--clr-muted); max-width: 480px; margin-inline: auto; font-size: .95rem; }

.search-card { background: var(--clr-surface); border: 1px solid var(--clr-border); border-radius: var(--radius); padding: 28px 24px; margin-bottom: 40px; }
.search-card__label { display: block; font-size: .8rem; color: var(--clr-muted); margin-bottom: 10px; letter-spacing: .04em; text-transform: uppercase; }
.input-row { display: flex; flex-wrap: wrap; gap: 12px; }
.input-wrap { position: relative; flex: 1; min-width: 200px; }
.input-wrap input, .input-wrap select { width: 100%; padding: 14px 16px; background: var(--clr-surface2); border: 1px solid var(--clr-border);
  border-radius: var(--radius-sm); color: var(--clr-text); font-family: inherit; font-size: .95rem; transition: border-color .2s, box-shadow .2s; }
.input-wrap input:focus, .input-wrap select:focus { outline: none; border-color: var(--clr-accent); box-shadow: 0 0 0 3px rgba(56,189,248,.15); }
.input-wrap input::placeholder { color: var(--clr-muted); }

.autocomplete { position: absolute; top: 100%; left: 0; right: 0; background: var(--clr-surface2); border: 1px solid var(--clr-border);
  border-radius: var(--radius-sm); margin-top: 4px; max-height: 260px; overflow-y: auto; list-style: none; display: none; z-index: 100; }
.autocomplete.show { display: block; animation: fadeIn .15s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }
.autocomplete li { padding: 12px 16px; cursor: pointer; font-size: .9rem; border-bottom: 1px solid var(--clr-border); display: flex; align-items: center; gap: 10px; }
.autocomplete li:last-child { border-bottom: none; }
.autocomplete li:hover, .autocomplete li.active { background: rgba(56,189,248,.1); }
.autocomplete li .highlight { color: var(--clr-accent); font-weight: 500; }
.autocomplete li .tipo-tag { font-size: .65rem; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; font-weight: 600; }
.autocomplete li .tipo-tag.docente { background: rgba(56,189,248,.15); color: var(--clr-accent); }
.autocomplete li .tipo-tag.materia { background: rgba(167,139,250,.15); color: var(--clr-accent2); }

.btn-buscar { padding: 14px 32px; background: linear-gradient(135deg, var(--clr-accent), var(--clr-accent2)); border: none; border-radius: var(--radius-sm);
  color: #0b0f1a; font-family: var(--font-head); font-size: 1.1rem; letter-spacing: .08em; cursor: pointer; transition: transform .15s, box-shadow .15s; }
.btn-buscar:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(56,189,248,.3); }

.results { display: none; }
.results.show { display: block; animation: fadeIn .3s ease; }
.results__header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 20px; flex-wrap: wrap; gap: 8px; }
.results__title { font-family: var(--font-head); font-size: 1.4rem; letter-spacing: .04em; }
.results__title span { color: var(--clr-accent); }
.results__count { font-size: .82rem; color: var(--clr-muted); }

.card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
.card { background: var(--clr-surface); border: 1px solid var(--clr-border); border-radius: var(--radius); padding: 20px; position: relative; overflow: hidden; transition: transform .2s, box-shadow .2s; }
.card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,.3); }
.card__turno { position: absolute; top: 0; right: 0; font-size: .65rem; font-weight: 700; letter-spacing: .06em; padding: 6px 14px;
  border-radius: 0 var(--radius) 0 var(--radius); text-transform: uppercase; }
.card__turno.man { background: rgba(251,191,36,.15); color: var(--clr-turno-man); }
.card__turno.med { background: rgba(251,146,60,.15); color: var(--clr-turno-med); }
.card__turno.tar { background: rgba(167,139,250,.15); color: var(--clr-turno-tar); }
.card__turno.noc { background: rgba(56,189,248,.15); color: var(--clr-turno-noc); }
.card__aula { font-family: var(--font-head); font-size: 2rem; letter-spacing: .05em; margin-bottom: 8px; color: var(--clr-accent); }
.card__materia { font-size: .95rem; font-weight: 500; margin-bottom: 12px; line-height: 1.3; }
.card__meta { display: flex; flex-direction: column; gap: 6px; }
.card__meta-item { display: flex; align-items: flex-start; gap: 8px; font-size: .82rem; color: var(--clr-muted); }
.card__meta-item .label { color: var(--clr-text); font-weight: 400; }

.msg { text-align: center; padding: 48px 24px; color: var(--clr-muted); font-size: .88rem; }
.msg.error { color: var(--clr-danger); }
.msg .icon-big { font-size: 2.4rem; margin-bottom: 12px; display: block; }

.admin-link { position: fixed; bottom: 20px; right: 20px; background: var(--clr-surface); border: 1px solid var(--clr-border);
  padding: 10px 16px; border-radius: var(--radius-sm); color: var(--clr-muted); text-decoration: none; font-size: .8rem; transition: all .2s; }
.admin-link:hover { background: var(--clr-surface2); color: var(--clr-text); }

@media (max-width: 560px) {
  .header { padding: 48px 0 32px; }
  .search-card { padding: 22px 18px; }
  .input-row .input-wrap { min-width: 100%; }
  .btn-buscar { width: 100%; }
  .card-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>
<div class="glow"></div>
<div class="wrapper">
  <header class="header">
    <div class="header__badge"><span class="dot"></span> Servicio activo ‚Äî UPDS 2026</div>
    <h1>Consulta de <span>Aulas</span><br/>Docentes</h1>
    <p>Ingrese el nombre del docente o la materia para ver las aulas asignadas en el presente per√≠odo acad√©mico.</p>
  </header>

  <section class="search-card">
    <label class="search-card__label">Materia o Nombre del Docente</label>
    <div class="input-row">
      <div class="input-wrap" id="search-wrap">
        <input type="text" id="input-search" autocomplete="off" placeholder="Ej: C√°lculo I, Miranda Hoyos‚Ä¶"/>
        <ul class="autocomplete" id="autocomplete-list"></ul>
      </div>
      <div class="input-wrap" style="max-width:170px;">
        <select id="select-turno">
          <option value="">Todos los turnos</option>
          <option value="MA√ëANA">Ma√±ana</option>
          <option value="MEDIO DIA">Medio D√≠a</option>
          <option value="TARDE">Tarde</option>
          <option value="NOCHE">Noche</option>
        </select>
      </div>
      <button class="btn-buscar" id="btn-buscar">Buscar</button>
    </div>
  </section>

  <section class="results" id="results">
    <div class="results__header">
      <h2 class="results__title" id="results-title">Resultados para <span id="results-name">‚Äî</span></h2>
      <span class="results__count" id="results-count">0 asignaciones</span>
    </div>
    <div id="results-body"></div>
  </section>
</div>

<a href="adminupds.html" class="admin-link">‚öôÔ∏è Admin</a>

<script>
const API_BASE = "https://consulta-aulas-upds.onrender.com/api";

const inputSearch = document.getElementById('input-search');
const autocompleteList = document.getElementById('autocomplete-list');
const selectTurno = document.getElementById('select-turno');
const btnBuscar = document.getElementById('btn-buscar');
const resultsSection = document.getElementById('results');
const resultsTitle = document.getElementById('results-title');
const resultsName = document.getElementById('results-name');
const resultsCount = document.getElementById('results-count');
const resultsBody = document.getElementById('results-body');

let debounceTimer;
let activeIndex = -1;

// Autocompletado combinado (docentes y materias)
inputSearch.addEventListener('input', () => {
  clearTimeout(debounceTimer);
  const q = inputSearch.value.trim();
  if (q.length < 2) { autocompleteList.classList.remove('show'); return; }
  debounceTimer = setTimeout(() => fetchSugerencias(q), 200);
});

async function fetchSugerencias(q) {
  try {
    const res = await fetch(`${API_BASE}/sugerencias?q=${encodeURIComponent(q)}`);
    const data = await res.json();
    renderAutocomplete(data.sugerencias, q);
  } catch (e) { autocompleteList.classList.remove('show'); }
}

function renderAutocomplete(items, query) {
  if (!items.length) { autocompleteList.classList.remove('show'); return; }
  const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
  autocompleteList.innerHTML = items.map((item, i) => {
    const highlighted = item.texto.replace(regex, '<span class="highlight">$1</span>');
    const tipoClass = item.tipo === 'docente' ? 'docente' : 'materia';
    const tipoLabel = item.tipo === 'docente' ? 'üë§ Docente' : 'üìö Materia';
    return `<li data-index="${i}" data-texto="${item.texto}">
      <span class="tipo-tag ${tipoClass}">${tipoLabel}</span>
      <span>${highlighted}</span>
    </li>`;
  }).join('');
  activeIndex = -1;
  autocompleteList.classList.add('show');
}

autocompleteList.addEventListener('click', e => {
  const li = e.target.closest('li');
  if (li) { inputSearch.value = li.dataset.texto; autocompleteList.classList.remove('show'); buscar(); }
});

inputSearch.addEventListener('keydown', e => {
  const items = autocompleteList.querySelectorAll('li');
  if (!items.length) return;
  if (e.key === 'ArrowDown') { e.preventDefault(); activeIndex = (activeIndex + 1) % items.length; updateActive(items); }
  else if (e.key === 'ArrowUp') { e.preventDefault(); activeIndex = (activeIndex - 1 + items.length) % items.length; updateActive(items); }
  else if (e.key === 'Enter' && activeIndex >= 0) { e.preventDefault(); items[activeIndex].click(); }
  else if (e.key === 'Escape') { autocompleteList.classList.remove('show'); }
});

function updateActive(items) {
  items.forEach((li, i) => li.classList.toggle('active', i === activeIndex));
  if (activeIndex >= 0) items[activeIndex].scrollIntoView({ block: 'nearest' });
}

document.addEventListener('click', e => { if (!e.target.closest('#search-wrap')) autocompleteList.classList.remove('show'); });

btnBuscar.addEventListener('click', buscar);
inputSearch.addEventListener('keydown', e => { if (e.key === 'Enter' && activeIndex < 0) buscar(); });

async function buscar() {
  const q = inputSearch.value.trim();
  const turno = selectTurno.value;
  if (!q) { inputSearch.focus(); return; }
  
  resultsBody.innerHTML = '<div class="msg"><div class="spinner" style="margin:0 auto;width:32px;height:32px;border:3px solid var(--clr-border);border-top-color:var(--clr-accent);border-radius:50%;animation:spin .8s linear infinite"></div><style>@keyframes spin{to{transform:rotate(360deg)}}</style></div>';
  resultsSection.classList.add('show');
  
  try {
    let url = `${API_BASE}/consulta?q=${encodeURIComponent(q)}`;
    if (turno) url += `&turno=${encodeURIComponent(turno)}`;
    const res = await fetch(url);
    const data = await res.json();
    
    if (data.error) { resultsBody.innerHTML = `<div class="msg error"><span class="icon-big">‚ö†Ô∏è</span>${data.error}</div>`; return; }
    
    resultsName.textContent = data.encontrado || q;
    resultsCount.textContent = `${data.total_asignaciones} asignaci√≥n${data.total_asignaciones !== 1 ? 'es' : ''} ${data.tipo_busqueda === 'materia' ? '(por materia)' : '(por docente)'}`;
    
    if (!data.asignaciones.length) {
      resultsBody.innerHTML = `<div class="msg"><span class="icon-big">üîç</span>No se encontraron resultados para "<strong>${q}</strong>"</div>`;
      return;
    }
    
    resultsBody.innerHTML = `<div class="card-grid">${data.asignaciones.map(a => renderCard(a, data.tipo_busqueda)).join('')}</div>`;
  } catch (e) {
    resultsBody.innerHTML = `<div class="msg error"><span class="icon-big">‚ùå</span>Error de conexi√≥n. Intente nuevamente.</div>`;
  }
}

function renderCard(a, tipoBusqueda) {
  const turnoClass = { 'MA√ëANA': 'man', 'MEDIO DIA': 'med', 'TARDE': 'tar', 'NOCHE': 'noc' }[a.turno] || '';
  let html = '<article class="card">';
  html += '<div class="card__turno ' + turnoClass + '">' + a.turno + '</div>';
  html += '<div class="card__aula">' + a.aula + '</div>';
  html += '<div class="card__materia">' + a.materia + '</div>';
  html += '<div class="card__meta">';
  if (tipoBusqueda === 'materia') {
    html += '<div class="card__meta-item"><span>üë§</span><span class="label">' + a.docente + '</span></div>';
  }
  html += '<div class="card__meta-item"><span>üïê</span><span class="label">' + a.horario + '</span></div>';
  if (tipoBusqueda === 'docente') {
    html += '<div class="card__meta-item"><span>üë§</span><span class="label">' + a.docente + '</span></div>';
  }
  html += '</div></article>';
  return html;
}
</script>
</body>
</html>
